# Contributing to nhssta

このドキュメントは、nhsstaプロジェクトへの貢献方法とコーディングスタイルガイドラインを説明します。

## コーディングスタイル

### 基本方針

- **C++17標準**を使用します
- 既存コードのスタイルを尊重し、一貫性を保ちます
- 自動フォーマットツール（clang-format）と静的解析ツール（clang-tidy）を使用してスタイルと品質を維持します

### インデント

- **スペース4文字**を使用します（タブは使用しません）
- 既存コードでタブが使用されている場合は、段階的にスペースに移行します

### 命名規則

- **クラス名**: PascalCase（例: `Ssta`, `RandomVariable`, `OpADD`）
- **関数名**: camelCase（例: `getLatResults()`, `read_dlib()`）
- **メンバ変数**: snake_case with trailing underscore（例: `is_lat_`, `signals_`, `dlib_`）
- **ローカル変数**: snake_case（例: `gate_name`, `signal_name`）
- **定数**: UPPER_SNAKE_CASE（例: `MINIMUM_VARIANCE`）

### ヘッダガード

- 形式: `NH_<FILENAME>__H`（例: `NH_SSTA__H`, `NH_COVARIANCE__H`）
- アンダースコア2つを使用します

### 名前空間

- グローバル名前空間の汚染を避けるため、適切な名前空間を使用します
- `using namespace` は関数スコープ内でのみ使用可能とします
- グローバルスコープでの `using namespace std;` は避けます（既存コードの `main.C` は段階的に改善）

### コメント

- ファイルヘッダには `// -*- c++ -*-` と著者名を含めます
- 複雑なロジックには説明コメントを追加します
- 日本語コメントも可とします

### コードフォーマット

- `clang-format` を使用してコードを整形します
- プロジェクトルートの `.clang-format` ファイルに設定が定義されています
- 新しいコードや変更されたコードには `clang-format` を適用してください

### 静的解析

- `clang-tidy` を使用してコードの品質をチェックします
- プロジェクトルートの `.clang-tidy` ファイルに設定が定義されています
- ローカルで `make tidy` を実行してチェックできます
- CIでも自動的にチェックされます

## 開発フロー

### ローカルでの開発

1. コードを変更する前に、既存のテストがすべて通ることを確認します
   ```bash
   make test
   ```

2. コードを変更した後、以下を実行します：
   ```bash
   # テストを実行
   make test
   
   # スタイルチェック（clang-tidy）
   make tidy
   
   # コードフォーマット（必要に応じて）
   clang-format -i src/YourFile.C
   ```

3. すべてのテストがパスし、警告が許容範囲内であることを確認してからコミットします

### プルリクエスト

- 新しい機能やバグ修正は、ブランチを作成してプルリクエストとして提出してください
- プルリクエストには、変更内容の説明とテスト結果を含めてください
- CIのチェック（ビルド、テスト、リンタ）がすべて通ることを確認してください

## テスト

- 新しい機能には必ずテストを追加してください
- 既存のテストが壊れないことを確認してください
- テストは Google Test フレームワークを使用します

## スタイル適用ポリシー

### 新規コード・変更コード

- **新規に追加するファイル**や**変更されたファイル**には、`clang-format`を適用してください
- プルリクエストを提出する前に、`make tidy`を実行して警告を確認してください
- 重要な警告（バグにつながる可能性があるもの）は修正してください

### 既存コード

- 既存のコードは段階的に改善していきます
- 既存ファイルを大幅に変更する場合は、そのファイルに`clang-format`を適用してください
- ただし、動作を変えない範囲で行ってください

### CIでのチェック

- CIでは`clang-tidy`と`clang-format --dry-run`が自動的に実行されます
- 現時点では警告があってもCIは失敗しません（ログとして表示されるだけ）
- 将来的には、合意できたチェックだけを`WarningsAsErrors`に引き上げていきます

## 質問や提案

- 質問や提案がある場合は、GitHubのIssuesで議論してください
- コーディングスタイルに関する質問も歓迎します

